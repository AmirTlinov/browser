{
  "protocolVersion": "2025-06-18",
  "serverInfo": {
    "name": "browser",
    "version": "0.1.0"
  },
  "tools": [
    {
      "name": "page",
      "description": "Analyze current page structure and content.\nUSAGE:\n- Default (AI-native): page()  # triage + affordances + next actions\n- In MCP_TOOLSET=v2: page() defaults to detail=\"map\" (actions-first)\n- Fast frontend triage (delta capable): page(detail=\"triage\", since=<cursor>)\n- Form details: page(detail=\"forms\", form_index=0)\n- Links list: page(detail=\"links\", limit=20)\n- Main content: page(detail=\"content\")\n- Frontend issues: page(detail=\"diagnostics\")\n- Delta frontend issues: page(detail=\"diagnostics\", since=<cursor>)\n- Accessibility query: page(detail=\"ax\", role=\"button\", name=\"Save\")\n- Visual AX overlay: page(detail=\"ax\", role=\"button\", name=\"Save\", with_screenshot=true)\n- Resource waterfall: page(detail=\"resources\", sort=\"duration\")\n- Performance vitals: page(detail=\"performance\")\n- Frames/iframes map: page(detail=\"frames\")\n- Visual frames overlay: page(detail=\"frames\", with_screenshot=true)\n- Stable selectors: page(detail=\"locators\", kind=\"button\")\n- Visual locator overlay: page(detail=\"locators\", with_screenshot=true)\n- Capability map (actions-first): page(detail=\"map\")\n- Navigation graph (visited pages): page(detail=\"graph\")\n- Super-report (one call): page(detail=\"audit\")\n- Super-report + net trace: page(detail=\"audit\", trace=true)\n- Page info: page(info=true)\n- Store full payload off-context: page(detail=\"diagnostics\", store=true)\n\nTHIS IS YOUR PRIMARY TOOL - call it first to understand the page.\n\nRESPONSE FORMAT:\n- Text results are returned as compact context-format Markdown ([LEGEND] + [CONTENT]), not JSON.\n",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "default": {},
        "properties": {
          "detail": {
            "type": "string",
            "enum": [
              "forms",
              "links",
              "buttons",
              "inputs",
              "content",
              "triage",
              "diagnostics",
              "ax",
              "resources",
              "performance",
              "frames",
              "locators",
              "map",
              "graph",
              "audit"
            ],
            "description": "Section to get details for"
          },
          "form_index": {
            "type": "integer",
            "description": "Specific form index when detail='forms'"
          },
          "offset": {
            "type": "integer",
            "default": 0,
            "description": "Pagination offset"
          },
          "limit": {
            "type": "integer",
            "default": 10,
            "description": "Max items to return"
          },
          "auto_scroll": {
            "description": "Auto-scroll the page before analysis (best-effort; useful for lazy-loaded content).",
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "object",
                "properties": {
                  "max_iters": {
                    "type": "integer",
                    "default": 8,
                    "description": "Max scroll iterations (bounded server-side)."
                  },
                  "direction": {
                    "type": "string",
                    "enum": [
                      "down",
                      "up",
                      "left",
                      "right"
                    ],
                    "default": "down",
                    "description": "Scroll direction per iteration."
                  },
                  "amount": {
                    "type": "integer",
                    "default": 700,
                    "description": "Scroll delta per iteration (pixels)."
                  },
                  "settle_ms": {
                    "type": "integer",
                    "default": 150,
                    "description": "Sleep after each scroll (ms) to allow lazy loads."
                  },
                  "until_js": {
                    "type": "string",
                    "description": "JS expression that returns true when scrolling can stop."
                  },
                  "container_selector": {
                    "type": "string",
                    "description": "Optional CSS selector for a scrollable container (feeds/lists)."
                  },
                  "stop_on_url_change": {
                    "type": "boolean",
                    "default": false,
                    "description": "Stop auto-scroll if the page URL changes (guards against SPA state jumps)."
                  },
                  "required": {
                    "type": "boolean",
                    "default": false,
                    "description": "If true, fail the tool call when auto-scroll errors."
                  }
                },
                "additionalProperties": false
              }
            ]
          },
          "auto_expand": {
            "description": "Auto-expand collapsed content (best-effort; 'show more/read more' patterns).",
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "object",
                "properties": {
                  "phrases": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Lowercased phrases to match (e.g., show more, read more)."
                  },
                  "selectors": {
                    "oneOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    ],
                    "description": "CSS selector(s) to scan for expand controls."
                  },
                  "include_links": {
                    "type": "boolean",
                    "default": false,
                    "description": "Allow anchor tags when they look like buttons (#/javascript:/role=button)."
                  },
                  "click_limit": {
                    "type": "integer",
                    "default": 6,
                    "description": "Max clicks per iteration."
                  },
                  "max_iters": {
                    "type": "integer",
                    "default": 6,
                    "description": "Max expand iterations (bounded server-side)."
                  },
                  "settle_ms": {
                    "type": "integer",
                    "default": 150,
                    "description": "Sleep after each click batch (ms) to allow hydration."
                  },
                  "required": {
                    "type": "boolean",
                    "default": false,
                    "description": "If true, fail the tool call when auto-expand errors."
                  }
                },
                "additionalProperties": false
              }
            ]
          },
          "since": {
            "type": "integer",
            "description": "For detail='triage'/'diagnostics'/'resources': return only changes since this cursor (ms)"
          },
          "store": {
            "type": "boolean",
            "default": false,
            "description": "Store the full result as an artifact for drilldown (keeps context window small)"
          },
          "role": {
            "type": "string",
            "description": "For detail='ax': accessibility role filter (e.g., button, link, checkbox)"
          },
          "name": {
            "type": "string",
            "description": "For detail='ax': accessibility name filter (visible label / accessible name)"
          },
          "sort": {
            "type": "string",
            "enum": [
              "start",
              "duration",
              "size"
            ],
            "default": "start",
            "description": "For diagnostics/resources: sort resource timings"
          },
          "kind": {
            "type": "string",
            "enum": [
              "all",
              "button",
              "link",
              "input"
            ],
            "default": "all",
            "description": "For detail='locators': what elements to include"
          },
          "info": {
            "type": "boolean",
            "description": "Get page info (url, title, scroll, viewport)"
          },
          "clear": {
            "type": "boolean",
            "default": false,
            "description": "For detail='diagnostics': clear stored events after snapshot"
          },
          "with_screenshot": {
            "type": "boolean",
            "default": false,
            "description": "For detail='triage', 'locators', or 'ax': attach a screenshot image to the result"
          },
          "overlay": {
            "type": "boolean",
            "default": true,
            "description": "For detail='locators' or 'ax' + with_screenshot: draw numbered overlay boxes (default: true)"
          },
          "overlay_limit": {
            "type": "integer",
            "default": 20,
            "description": "For detail='locators' or 'ax' + with_screenshot: cap overlay items (default: 20)"
          },
          "trace": {
            "description": "For detail='audit': optionally capture a bounded Tier-0 network trace (stored as an artifact) for deep debugging.",
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "object",
                "properties": {
                  "include": {
                    "description": "Include URL substring patterns (case-insensitive).",
                    "oneOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    ]
                  },
                  "exclude": {
                    "description": "Exclude URL substring patterns (case-insensitive).",
                    "oneOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    ]
                  },
                  "types": {
                    "description": "Resource types (e.g., XHR, Fetch). Defaults to XHR/Fetch if no filters are set.",
                    "oneOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    ]
                  },
                  "capture": {
                    "type": "string",
                    "enum": [
                      "meta",
                      "request",
                      "body",
                      "full"
                    ],
                    "default": "meta",
                    "description": "Capture level: meta only, request postData, response body, or full (request+body)."
                  },
                  "redact": {
                    "type": "boolean",
                    "default": true,
                    "description": "Redact sensitive tokens from captured bodies (recommended)."
                  },
                  "maxBodyBytes": {
                    "type": "integer",
                    "default": 80000,
                    "description": "Max bytes per response body (after decoding)."
                  },
                  "maxTotalBytes": {
                    "type": "integer",
                    "default": 600000,
                    "description": "Total byte budget across all captured bodies (0 = unbounded)."
                  },
                  "since": {
                    "type": "integer",
                    "description": "Only include requests completed after this timestamp (ms)."
                  },
                  "offset": {
                    "type": "integer",
                    "default": 0,
                    "description": "Pagination offset within the matched request set."
                  },
                  "limit": {
                    "type": "integer",
                    "default": 20,
                    "description": "Max trace items to include (tool output stays bounded; full trace goes to artifact)."
                  },
                  "store": {
                    "type": "boolean",
                    "default": true,
                    "description": "Store the trace as an artifact for drilldown (recommended)."
                  },
                  "export": {
                    "type": "boolean",
                    "default": false,
                    "description": "Export the artifact to disk (implies store=true)."
                  },
                  "overwrite": {
                    "type": "boolean",
                    "default": false,
                    "description": "Overwrite export destination if exists."
                  },
                  "name": {
                    "type": "string",
                    "description": "Optional export filename for the trace artifact."
                  },
                  "clear": {
                    "type": "boolean",
                    "default": false,
                    "description": "Clear the Tier-0 net trace buffer after capture."
                  }
                },
                "additionalProperties": false
              }
            ]
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "extract_content",
      "description": "SMART EXTRACT: Get structured content from page with pagination.\nUse instead of full DOM dumps when you need specific data.\nOVERVIEW MODE (default):\nReturns content structure summary with counts and hints.\n\nDETAIL MODES with pagination:\n- content_type=\"main\" + offset/limit: Main text paragraphs\n- content_type=\"table\": List of tables with metadata\n- content_type=\"table\" + table_index=N + offset/limit: Rows of table N\n- content_type=\"links\" + offset/limit: All links\n- content_type=\"headings\": Document outline (h1-h6)\n- content_type=\"images\" + offset/limit: Images with metadata\n",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "heuristic_level": {
            "type": "integer",
            "enum": [
              0,
              1,
              2,
              3
            ],
            "default": 1,
            "description": "Reliability heuristic level: 0 strict/minimal, 1 balanced (default), 2 robust, 3 diagnostic."
          },
          "strict_params": {
            "type": "boolean",
            "default": false,
            "description": "Fail fast on invalid params when true; otherwise coerce with warnings."
          },
          "auto_dismiss_overlays": {
            "type": "boolean",
            "default": false,
            "description": "Best-effort dismiss blocking DOM overlays before click/type/form steps."
          },
          "url": {
            "type": "string",
            "description": "Optional URL to navigate before extraction (one-call navigate+extract)."
          },
          "wait": {
            "type": "string",
            "enum": [
              "navigation",
              "load",
              "domcontentloaded",
              "networkidle",
              "none"
            ],
            "default": "load",
            "description": "What to wait for after navigation (default: load)."
          },
          "content_type": {
            "type": "string",
            "enum": [
              "overview",
              "main",
              "table",
              "links",
              "headings",
              "images"
            ],
            "description": "What to extract (default: overview)",
            "default": "overview"
          },
          "selector": {
            "type": "string",
            "description": "Optional CSS selector to limit scope"
          },
          "offset": {
            "type": "integer",
            "description": "Starting index for paginated results (default: 0)",
            "default": 0
          },
          "limit": {
            "type": "integer",
            "description": "Max items to return (default: 10, max: 50)",
            "default": 10
          },
          "table_index": {
            "type": "integer",
            "description": "Specific table index when content_type='table'"
          },
          "content_root_debug": {
            "type": "boolean",
            "default": false,
            "description": "Attach content-root heuristics debug data (best-effort)."
          },
          "auto_expand": {
            "description": "Auto-expand collapsed content before extraction (best-effort).",
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "object",
                "properties": {
                  "phrases": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Phrases to match (show more/read more/etc.)"
                  },
                  "selectors": {
                    "oneOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    ],
                    "description": "Selectors to scan for expandable controls."
                  },
                  "include_links": {
                    "type": "boolean",
                    "default": false,
                    "description": "Allow anchor tags when they act like buttons."
                  },
                  "click_limit": {
                    "type": "integer",
                    "default": 6,
                    "description": "Max clicks per iteration."
                  },
                  "max_iters": {
                    "type": "integer",
                    "default": 6,
                    "description": "Max iterations (bounded)."
                  },
                  "timeout_s": {
                    "type": "number",
                    "default": 0.4,
                    "description": "Per-condition wait timeout."
                  },
                  "wait": {
                    "type": "object",
                    "description": "Optional wait args after each click batch."
                  },
                  "settle_ms": {
                    "type": "integer",
                    "default": 150,
                    "description": "Backoff between iterations (ms)."
                  },
                  "required": {
                    "type": "boolean",
                    "default": false,
                    "description": "If true, fail the tool call when auto-expand errors."
                  }
                },
                "additionalProperties": false
              }
            ]
          },
          "auto_scroll": {
            "description": "Auto-scroll before extraction (best-effort; useful for lazy-loaded content).",
            "oneOf": [
              {
                "type": "boolean"
              },
              {
                "type": "object",
                "properties": {
                  "max_iters": {
                    "type": "integer",
                    "default": 8,
                    "description": "Max scroll iterations (bounded server-side)."
                  },
                  "direction": {
                    "type": "string",
                    "enum": [
                      "down",
                      "up",
                      "left",
                      "right"
                    ],
                    "default": "down",
                    "description": "Scroll direction per iteration."
                  },
                  "amount": {
                    "type": "integer",
                    "default": 700,
                    "description": "Scroll delta per iteration (pixels)."
                  },
                  "settle_ms": {
                    "type": "integer",
                    "default": 150,
                    "description": "Sleep after each scroll (ms) to allow lazy loads."
                  },
                  "until_js": {
                    "type": "string",
                    "description": "JS expression that returns true when scrolling can stop."
                  },
                  "container_selector": {
                    "type": "string",
                    "description": "Optional CSS selector for a scrollable container (feeds/lists)."
                  },
                  "stop_on_url_change": {
                    "type": "boolean",
                    "default": false,
                    "description": "Stop auto-scroll if the page URL changes."
                  },
                  "required": {
                    "type": "boolean",
                    "default": false,
                    "description": "If true, fail the tool call when auto-scroll errors."
                  }
                },
                "additionalProperties": false
              }
            ]
          },
          "retry_on_error": {
            "type": "boolean",
            "default": false,
            "description": "Detect common error text and attempt bounded recovery before extraction."
          },
          "error_texts": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Text snippets that signal partial failure (lazy load errors)."
          },
          "max_error_retries": {
            "type": "integer",
            "default": 2,
            "description": "Max recovery attempts when error text is detected (bounded)."
          },
          "retry_wait": {
            "type": "object",
            "description": "Optional wait args between recovery steps (for + timeout).",
            "properties": {
              "for": {
                "type": "string",
                "enum": [
                  "navigation",
                  "load",
                  "domcontentloaded",
                  "networkidle"
                ],
                "default": "networkidle"
              },
              "timeout": {
                "type": "number",
                "default": 6.0
              }
            },
            "additionalProperties": false
          },
          "retry_scroll": {
            "type": "object",
            "description": "Optional scroll args between recovery checks.",
            "properties": {
              "direction": {
                "type": "string",
                "enum": [
                  "down",
                  "up",
                  "left",
                  "right"
                ],
                "default": "down"
              },
              "amount": {
                "type": "integer",
                "default": 400
              },
              "container_selector": {
                "type": "string"
              }
            },
            "additionalProperties": false
          },
          "retry_reload": {
            "type": "boolean",
            "default": false,
            "description": "Reload the page during recovery attempts."
          },
          "store": {
            "type": "boolean",
            "default": false,
            "description": "Store the full result as an artifact (keeps output small)."
          }
        },
        "required": [],
        "additionalProperties": false
      }
    },
    {
      "name": "run",
      "description": "Run an AI-native scenario using OAVR: Observe → Act → Verify → Report.\n\nThis is the recommended entrypoint for multi-step work:\n- Holds one shared CDP session across all actions (less flake, fewer round-trips).\n- Returns a compact report + proof so agents avoid extra \"check\" calls.\n\nDefault report behavior:\n- MCP_TOOLSET=v1/default: report=\"observe\"\n- MCP_TOOLSET=v2: report=\"map\"\n\nINTERNAL ACTIONS (v2):\n`run()` can execute the same action steps as `flow`, including (common set):\n- navigate, click, type, scroll, form, wait\n- page (triage/diagnostics/ax/locators/resources/performance)\n- app (high-level app macros/adapters for complex web apps)\n- dialog (alert/confirm/prompt)\n- captcha (analyze/screenshot/click_blocks/submit)\n- fetch, storage, download\n- net(action=\"harLite\")  # Tier-0 network slice\n- net(action=\"trace\")    # Tier-0 deep trace (bounded, on-demand)\nThese are not separate top-level tools in v2; they are actions inside `run`.\n\nINTERNAL ACTIONS (v3 additions; only inside `run(actions=[...])`, not top-level tools):\nSchemas (shape):\n- assert: {\"assert\": {\"timeout_s\": 5, \"url\": \"...\", \"title\": \"...\", \"selector\": \"...\", \"text\": \"...\", \"js\": \"...\" }}\n- when: {\"when\": {\"if\": {\"url\": \"...\", \"selector\": \"...\", \"text\": \"...\", \"js\": \"...\"}, \"then\": [...], \"else\": [...]}}\n- macro: {\"macro\": {\"name\": \"...\", \"args\": {...}, \"dry_run\": true}}\n\nNotes:\n- Server-side only (no LLM execution); deterministic and bounded by run limits.\n- assert is fail-closed: timeout or mismatch fails the run.\n- when executes a single branch (no loops); else is optional.\n- macro is for compact, deterministic expansions (e.g., include saved step lists).\n\nINTERNAL ACTIONS (v4 additions; only inside `run(actions=[...])`, not top-level tools):\nSchemas (shape):\n- repeat: {\"repeat\": {\"max_iters\": 5, \"until\": {\"selector\": \"...\", \"text\": \"...\", \"url\": \"...\", \"js\": \"...\"}, \"steps\": [...], \"max_time_s\": 20, \"backoff_s\": 0.2, \"backoff_factor\": 1.5, \"backoff_max_s\": 2.0}}\n\nNotes:\n- repeat is bounded: max_iters is capped server-side (no unbounded loops).\n- If `until` is omitted, repeat runs exactly max_iters times and succeeds (like a for-loop).\n- If `until` is provided and never matches, repeat fails closed after max_iters.\n- Optional `max_time_s` adds a wall-clock budget for the whole repeat loop (fail-closed when exhausted).\n- Optional backoff (`backoff_s`, `backoff_factor`, `backoff_max_s`) sleeps between iterations (deterministic, bounded).\n- `js` conditions are evaluated in-page and must return a truthy value.\n\nExamples:\n1) {\"assert\": {\"url\": \"https://example.com\", \"title\": \"Example Domain\", \"timeout_s\": 5}}\n2) {\"when\": {\"if\": {\"selector\": \"#login\", \"text\": \"Sign in\"}, \"then\": [{\"click\": {\"selector\": \"#login\"}}], \"else\": [{\"navigate\": {\"url\": \"https://example.com/login\"}}]}}\n3) {\"macro\": {\"name\": \"trace_then_screenshot\", \"args\": {\"trace\": \"harLite\"}, \"dry_run\": true}}\n4) {\"macro\": {\"name\": \"include_memory_steps\", \"args\": {\"memory_key\": \"workflow.login\", \"params\": {\"user\": \"alice\"}}}}\n5) {\"repeat\": {\"max_iters\": 10, \"until\": {\"selector\": \"#result\"}, \"steps\": [{\"scroll\": {\"direction\": \"down\"}}]}}\n6) {\"macro\": {\"name\": \"auto_expand\", \"args\": {\"phrases\": [\"show more\", \"read more\"]}}}\n6) {\"repeat\": {\"max_iters\": 8, \"until\": {\"js\": \"window.scrollY > 2000\"}, \"steps\": [{\"scroll\": {\"direction\": \"down\"}}]}}\n\nHIGH-LEVERAGE INTERNAL ACTION:\n- act(ref=\"aff:...\")  # resolve a stable affordance ref from page(detail=\"locators\") / page(detail=\"map\") / page(detail=\"triage\")\n  This is the fastest way to click/focus without re-specifying selectors/text.\n- act(label=\"Save\", kind=\"button\")  # deterministic label resolver (exact match; uses stored affordances; may refresh once)\n\nACTION FORMATS (same as flow steps):\n1) Explicit:\n   {\"tool\": \"navigate\", \"args\": {\"url\": \"https://example.com\"}}\n2) Shorthand:\n   {\"navigate\": {\"url\": \"https://example.com\"}}\n\nSTATEFUL RUNS (export → interpolate):\n- You can export scalars from one action and reuse them in later actions via `{{var}}` / `${var}`.\n  This enables single-call pipelines (e.g., capture trace → read artifact → act on results) without extra tool calls.\n\nSAFETY:\n- Mark an action as irreversible (requires confirm_irreversible=true):\n  {\"tool\":\"click\",\"args\":{\"text\":\"Delete\"},\"irreversible\":true}\n\nROBUSTNESS:\n- If a blocking JS dialog is open, non-dialog actions fail fast with a dialog suggestion.\n- Optional: auto-handle dialogs (dismiss/accept) based on policy mode (strict vs permissive).\n- Optional: auto-recover from known CDP brick states and continue (bounded attempts).\n- If any action produces an image (e.g., CAPTCHA screenshot), the image is stored off-context\n  as an artifact and surfaced via `next` drilldown hints.\nOUTPUT:\n- Always context-format Markdown (`[LEGEND]` + `[CONTENT]`), not JSON.\n- Defaults to a delta observe report since the run start.\n",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "goal": {
            "type": "string",
            "description": "Human goal (optional, for logging/traceability)"
          },
          "heuristic_level": {
            "type": "integer",
            "enum": [
              0,
              1,
              2,
              3
            ],
            "default": 1,
            "description": "Reliability heuristic level: 0 strict/minimal, 1 balanced (default), 2 robust, 3 diagnostic."
          },
          "strict_params": {
            "type": "boolean",
            "default": false,
            "description": "Fail fast on invalid params when true; otherwise coerce with warnings."
          },
          "actions": {
            "type": "array",
            "minItems": 1,
            "description": "List of actions to execute (explicit or shorthand format)",
            "items": {
              "type": "object"
            }
          },
          "record_memory_key": {
            "type": "string",
            "description": "Optional: record the original actions into agent memory under this key (runbook recorder)"
          },
          "record_mode": {
            "type": "string",
            "enum": [
              "sanitized",
              "raw"
            ],
            "default": "sanitized",
            "description": "Recorder mode: sanitized (safe-by-default) or raw (stores literals; risky)"
          },
          "record_on_failure": {
            "type": "boolean",
            "default": false,
            "description": "If true, record actions even when the run fails (default: false)"
          },
          "steps": {
            "type": "array",
            "minItems": 1,
            "description": "DEPRECATED alias for actions",
            "items": {
              "type": "object"
            }
          },
          "start_at": {
            "type": "integer",
            "default": 0,
            "description": "Start executing actions from this index (resume a partially completed run)"
          },
          "stop_on_error": {
            "type": "boolean",
            "default": true,
            "description": "Stop on the first non-optional error (default: true)"
          },
          "confirm_irreversible": {
            "type": "boolean",
            "default": false,
            "description": "Allow steps explicitly marked irreversible=true (default: false)"
          },
          "auto_dialog": {
            "type": "string",
            "enum": [
              "auto",
              "off",
              "dismiss",
              "accept"
            ],
            "default": "auto",
            "description": "Auto-handle blocking JS dialogs: auto (strict->off, permissive->dismiss), or force off/dismiss/accept"
          },
          "auto_recover": {
            "type": "boolean",
            "default": true,
            "description": "Auto-recover from known CDP brick states (timeouts/unreachable) and continue when safe (default: true)"
          },
          "max_recoveries": {
            "type": "integer",
            "default": 1,
            "description": "Maximum number of auto-recovery attempts per run (default: 1)"
          },
          "recover_hard": {
            "type": "boolean",
            "default": false,
            "description": "Prefer hard recovery (restart owned Chrome) when recovering (default: false)"
          },
          "recover_timeout": {
            "type": "number",
            "default": 5.0,
            "description": "Recovery timeout seconds (default: 5.0)"
          },
          "timeout_profile": {
            "type": "string",
            "enum": [
              "fast",
              "default",
              "slow"
            ],
            "default": "default",
            "description": "Optional timeout profile (sets sane defaults for timeouts and internal waits)"
          },
          "action_timeout": {
            "type": "number",
            "default": 30.0,
            "description": "Per-action watchdog seconds (guarantees bounded run time; default: 30.0)"
          },
          "auto_download": {
            "type": "boolean",
            "default": false,
            "description": "Auto-capture downloads after click-like actions (stores as artifact when detected; default: false)"
          },
          "auto_download_timeout": {
            "type": "number",
            "default": 3.0,
            "description": "Auto-download wait seconds (bounded; default: 3.0)"
          },
          "auto_tab": {
            "type": "boolean",
            "default": false,
            "description": "Auto-switch to a newly opened tab after click-like actions (best-effort; default: false)"
          },
          "auto_affordances": {
            "type": "boolean",
            "default": true,
            "description": "Auto-refresh affordances when act(ref/label) looks stale (URL mismatch or missing refs; default: true)"
          },
          "proof": {
            "type": "boolean",
            "default": true,
            "description": "Attach compact per-action proof (delta triage + page state) to avoid extra check calls"
          },
          "proof_screenshot": {
            "type": "string",
            "enum": [
              "none",
              "artifact"
            ],
            "default": "artifact",
            "description": "How to capture screenshots for proof (default: store off-context as artifact)"
          },
          "screenshot_on_ambiguity": {
            "type": "boolean",
            "default": true,
            "description": "When proof is enabled, capture a screenshot if the action is ambiguous (default: true)"
          },
          "delta_report": {
            "type": "boolean",
            "default": true,
            "description": "Make report snapshots delta-only since the run start (default: true)"
          },
          "actions_output": {
            "type": "string",
            "enum": [
              "compact",
              "errors",
              "none"
            ],
            "default": "compact",
            "description": "How much per-action output to return (default: compact)"
          },
          "screenshot_on_error": {
            "type": "boolean",
            "default": false,
            "description": "If the run fails, attach a screenshot (default: false)"
          },
          "report": {
            "type": "string",
            "enum": [
              "none",
              "observe",
              "audit",
              "triage",
              "diagnostics",
              "map",
              "graph"
            ],
            "default": "observe",
            "description": "Attach one compact final report snapshot (default: observe)"
          },
          "report_limit": {
            "type": "integer",
            "default": 30,
            "description": "Limit for report=audit/triage/diagnostics (default: 30)"
          },
          "with_screenshot": {
            "type": "boolean",
            "default": false,
            "description": "Attach a final screenshot image to the result"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "flow",
      "description": "DEPRECATED: use `run(...)` instead.\n\nRun a compact multi-step browser workflow in a single tool call.\n\nGoal: reduce tool-call count + reduce output noise. One call = many steps + one compact summary.\n\nSTEP FORMATS:\n1) Explicit:\n   {\"tool\": \"navigate\", \"args\": {\"url\": \"https://example.com\"}}\n2) Shorthand:\n   {\"navigate\": {\"url\": \"https://example.com\"}}\n\nOPTIONAL EXPORTS (explicit or shorthand steps):\n- Export scalar fields from a step's raw payload without dumping the full output:\n  {\"tool\":\"page\",\"args\":{\"detail\":\"triage\"},\"export\":{\"cursor\":\"cursor\",\"url\":\"triage.url\"}}\n\nSTATEFUL FLOWS (export → interpolate):\n- Exports persist across steps inside the same `flow(...)`/`run(...)` call.\n- Reference exported vars in later step args via `{{var}}` or `${var}`.\n  - Exact placeholder preserves scalar type: {\"timeout\":\"{{cursor}}\"} → int\n  - Inline replacement stringifies: {\"url\":\".../{{artifactId}}\"} → str\nOUTPUT:\n- Always context-format Markdown (`[LEGEND]` + `[CONTENT]`), not JSON.\n- Step list is summary-only by default (no massive dumps).\n",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "heuristic_level": {
            "type": "integer",
            "enum": [
              0,
              1,
              2,
              3
            ],
            "default": 1,
            "description": "Reliability heuristic level: 0 strict/minimal, 1 balanced (default), 2 robust, 3 diagnostic."
          },
          "strict_params": {
            "type": "boolean",
            "default": false,
            "description": "Fail fast on invalid params when true; otherwise coerce with warnings."
          },
          "auto_dismiss_overlays": {
            "type": "boolean",
            "default": false,
            "description": "Best-effort dismiss blocking DOM overlays before click/type/form steps."
          },
          "steps": {
            "type": "array",
            "minItems": 1,
            "description": "List of steps to execute (explicit or shorthand format)",
            "items": {
              "type": "object"
            }
          },
          "start_at": {
            "type": "integer",
            "default": 0,
            "description": "Start executing steps from this index (resume a partially completed flow)"
          },
          "record_memory_key": {
            "type": "string",
            "description": "Optional: record the original steps into agent memory under this key (runbook recorder)"
          },
          "record_mode": {
            "type": "string",
            "enum": [
              "sanitized",
              "raw"
            ],
            "default": "sanitized",
            "description": "Recorder mode: sanitized (safe-by-default) or raw (stores literals; risky)"
          },
          "record_on_failure": {
            "type": "boolean",
            "default": false,
            "description": "If true, record steps even when the flow fails (default: false)"
          },
          "stop_on_error": {
            "type": "boolean",
            "default": true,
            "description": "Stop the flow on the first non-optional error (default: true)"
          },
          "delta_final": {
            "type": "boolean",
            "default": true,
            "description": "If final snapshot is enabled, make it delta-only (since the flow start) (default: true)"
          },
          "steps_output": {
            "type": "string",
            "enum": [
              "compact",
              "errors",
              "none"
            ],
            "default": "compact",
            "description": "How much per-step output to return (default: compact)"
          },
          "screenshot_on_error": {
            "type": "boolean",
            "default": false,
            "description": "If the flow fails, attach a screenshot (default: false)"
          },
          "triage_on_error": {
            "type": "boolean",
            "default": true,
            "description": "If the flow fails, include a delta triage snapshot (default: true)"
          },
          "diagnostics_on_error": {
            "type": "boolean",
            "default": false,
            "description": "If the flow fails, include a delta diagnostics snapshot (default: false)"
          },
          "final": {
            "type": "string",
            "enum": [
              "none",
              "observe",
              "audit",
              "triage",
              "diagnostics",
              "map",
              "graph"
            ],
            "default": "observe",
            "description": "Attach one compact final snapshot (default: observe)"
          },
          "final_limit": {
            "type": "integer",
            "default": 30,
            "description": "Limit for final=audit/triage/diagnostics (default: 30)"
          },
          "step_proof": {
            "type": "boolean",
            "default": false,
            "description": "Attach compact per-step proof (internal; default: false)"
          },
          "proof_screenshot": {
            "type": "string",
            "enum": [
              "none",
              "artifact"
            ],
            "default": "none",
            "description": "How to capture screenshots for proof (default: none)"
          },
          "screenshot_on_ambiguity": {
            "type": "boolean",
            "default": false,
            "description": "Capture a screenshot when a step is ambiguous (default: false)"
          },
          "auto_dialog": {
            "type": "string",
            "enum": [
              "auto",
              "off",
              "dismiss",
              "accept"
            ],
            "default": "off",
            "description": "Auto-handle blocking JS dialogs (default: off)"
          },
          "auto_recover": {
            "type": "boolean",
            "default": false,
            "description": "Auto-recover from CDP brick states (default: false)"
          },
          "max_recoveries": {
            "type": "integer",
            "default": 0,
            "description": "Maximum number of recovery attempts (default: 0)"
          },
          "recover_hard": {
            "type": "boolean",
            "default": false,
            "description": "Prefer hard recovery (restart owned Chrome) when recovering (default: false)"
          },
          "recover_timeout": {
            "type": "number",
            "default": 5.0,
            "description": "Recovery timeout seconds (default: 5.0)"
          },
          "timeout_profile": {
            "type": "string",
            "enum": [
              "fast",
              "default",
              "slow"
            ],
            "default": "default",
            "description": "Optional timeout profile (sets sane defaults for timeouts and internal waits)"
          },
          "action_timeout": {
            "type": "number",
            "default": 30.0,
            "description": "Per-step watchdog seconds (guarantees bounded flow time; default: 30.0)"
          },
          "auto_download": {
            "type": "boolean",
            "default": false,
            "description": "Auto-capture downloads after click-like steps (stores as artifact when detected; default: false)"
          },
          "auto_download_timeout": {
            "type": "number",
            "default": 3.0,
            "description": "Auto-download wait seconds (bounded; default: 3.0)"
          },
          "auto_tab": {
            "type": "boolean",
            "default": false,
            "description": "Auto-switch to a newly opened tab after click-like actions (best-effort; default: false)"
          },
          "auto_affordances": {
            "type": "boolean",
            "default": true,
            "description": "Auto-refresh affordances when act(ref/label) looks stale (URL mismatch or missing refs; default: true)"
          },
          "with_screenshot": {
            "type": "boolean",
            "default": false,
            "description": "Attach a final screenshot image to the result"
          }
        },
        "required": [
          "steps"
        ],
        "additionalProperties": false
      }
    },
    {
      "name": "runbook",
      "description": "Runbooks: save and execute reusable step lists stored in agent memory.\nUSAGE:\n- Save: runbook(action=\"save\", key=\"runbook_login\", steps=[...])\n- Run: runbook(action=\"run\", key=\"runbook_login\", params={...}, run_args={...})\n- List: runbook(action=\"list\", limit=20)\n- Get: runbook(action=\"get\", key=\"runbook_login\")\n- Delete: runbook(action=\"delete\", key=\"runbook_login\")\n",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "enum": [
              "save",
              "run",
              "list",
              "get",
              "delete"
            ],
            "default": "list",
            "description": "Runbook action"
          },
          "key": {
            "type": "string",
            "description": "Runbook key in agent memory"
          },
          "steps": {
            "type": "array",
            "description": "Runbook step list (for action='save')",
            "items": {
              "type": "object"
            }
          },
          "params": {
            "type": "object",
            "description": "Params for {{param:...}} placeholders (for action='run')"
          },
          "run_args": {
            "type": "object",
            "description": "Optional run(...) arguments (for action='run'); actions are provided by the runbook"
          },
          "goal": {
            "type": "string",
            "description": "Optional goal string (for action='run')"
          },
          "allow_sensitive": {
            "type": "boolean",
            "default": false,
            "description": "Allow sensitive keys / literals (NOT encrypted; use carefully)"
          },
          "include_sensitive": {
            "type": "boolean",
            "default": false,
            "description": "Include sensitive keys in list output (default: false)"
          },
          "limit": {
            "type": "integer",
            "default": 20,
            "description": "Limit for list, and preview size for get (default: 20)"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "app",
      "description": "High-level app macros/adapters for complex web apps (Miro/Figma/etc.).\n\nUse this when a site is *not* DOM-driven (canvas apps) and low-level click/drag would require\nhundreds of tiny actions. This tool moves the loop into the server for speed + stability.\nUSAGE:\n- Auto-detect app from current URL:\n  app(op=\"diagram\", params={...})\n\n- Force a specific adapter:\n  app(app=\"miro\", op=\"diagram\", params={...})\n\nCommon params (for diagram adapters):\n- strategy: \"auto\" (paste-first in extension mode, then import fallback), \"paste\" (paste only), \"import\" (file chooser only)\n\nCommon ops:\n- op=\"diagram\": generate and insert a simple architecture diagram (SVG) via paste→drop→import fallbacks\n- op=\"insert\": insert user-provided payload (svg/text/files) with the same fast fallbacks\n\nWITHIN run():\n  run(actions=[\n    {\"tool\":\"app\",\"args\":{\"app\":\"miro\",\"op\":\"diagram\",\"params\":{\"title\":\"...\", \"nodes\":[...], \"edges\":[...]}}}\n  ])\n\nDRY RUN (planning / debugging):\n  app(app=\"miro\", op=\"diagram\", params={...}, dry_run=true)\n",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "app": {
            "type": "string",
            "default": "auto",
            "description": "Adapter name ('auto' to detect by URL)"
          },
          "op": {
            "type": "string",
            "description": "Operation name (adapter-specific), e.g. 'diagram'"
          },
          "params": {
            "type": "object",
            "description": "Operation parameters (adapter-specific)"
          },
          "dry_run": {
            "type": "boolean",
            "default": false,
            "description": "If true, return the planned steps without executing them"
          }
        },
        "required": [
          "op"
        ],
        "additionalProperties": false
      }
    },
    {
      "name": "navigate",
      "description": "Navigate to URL or perform navigation action.\nUSAGE:\n- Go to URL: navigate(url=\"https://example.com\")\n- Go back: navigate(action=\"back\")\n- Go forward: navigate(action=\"forward\")\n- Reload: navigate(action=\"reload\")\nAUTO-WAIT: Waits for page load by default. Use wait=\"none\" to skip.\nRESPONSE EXAMPLE:\n{\n  \"url\": \"https://example.com/\",\n  \"title\": \"Example Domain\",\n  \"waited\": \"load\"\n}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "description": "URL to navigate to"
          },
          "action": {
            "type": "string",
            "enum": [
              "back",
              "forward",
              "reload"
            ],
            "description": "Navigation action instead of URL"
          },
          "wait": {
            "type": "string",
            "enum": [
              "navigation",
              "load",
              "domcontentloaded",
              "networkidle",
              "none"
            ],
            "default": "load",
            "description": "What to wait for after navigation (default: load)"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "click",
      "description": "Universal click tool - by text, selector, or coordinates.\n\nUSAGE (in order of preference):\n- By visible text: click(text=\"Sign In\")\n- By text + role: click(text=\"Submit\", role=\"button\")\n- Prefer AX (role+name): click(text=\"Submit\", role=\"button\", strategy=\"ax\")\n- By backend DOM node id (stable handle): click(backendDOMNodeId=123)\n- By ref (stable handle): click(ref=\"dom:123\")\n- By selector: click(selector=\"#login-btn\")\n- By coordinates: click(x=100, y=200)\n- Double click: click(text=\"file.txt\", double=true)\n- Right click: click(selector=\".item\", button=\"right\")\nAUTO-WAIT: After clicking links, waits for navigation.\nRESPONSE EXAMPLE:\n{\n  \"success\": true,\n  \"clicked\": {\"tag\": \"BUTTON\", \"text\": \"Sign In\", \"x\": 150, \"y\": 300},\n  \"page_changed\": false\n}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "text": {
            "type": "string",
            "description": "Visible text of element to click (preferred)"
          },
          "selector": {
            "type": "string",
            "description": "CSS selector of element"
          },
          "backendDOMNodeId": {
            "type": "integer",
            "description": "Stable element handle (from page(detail='ax'))"
          },
          "ref": {
            "type": "string",
            "description": "Stable element ref like 'dom:123' (from page(detail='ax'))"
          },
          "x": {
            "type": "number",
            "description": "X coordinate for pixel click"
          },
          "y": {
            "type": "number",
            "description": "Y coordinate for pixel click"
          },
          "role": {
            "type": "string",
            "enum": [
              "button",
              "link",
              "checkbox",
              "radio",
              "tab",
              "menuitem"
            ],
            "description": "Filter by element role"
          },
          "strategy": {
            "type": "string",
            "enum": [
              "auto",
              "ax",
              "dom"
            ],
            "default": "auto",
            "description": "Element-finding strategy: auto (default), ax (Accessibility), dom (JS/DOM)"
          },
          "near": {
            "type": "string",
            "description": "Find element near this text (for unlabeled elements)"
          },
          "index": {
            "type": "integer",
            "default": 0,
            "description": "If multiple matches, which one (0=first, -1=last)"
          },
          "double": {
            "type": "boolean",
            "default": false,
            "description": "Double click instead of single"
          },
          "button": {
            "type": "string",
            "enum": [
              "left",
              "right",
              "middle"
            ],
            "default": "left",
            "description": "Mouse button"
          },
          "wait_after": {
            "type": "string",
            "enum": [
              "auto",
              "navigation",
              "none"
            ],
            "default": "auto",
            "description": "What to wait for after click"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "type",
      "description": "Type text into element or press keys.\nUSAGE:\n- Type into element: type(selector=\"#email\", text=\"user@example.com\")\n- Type into element by backend handle: type(backendDOMNodeId=123, text=\"user@example.com\", clear=true)\n- Type into element by ref: type(ref=\"dom:123\", text=\"user@example.com\", clear=true)\n- Type into focused: type(text=\"hello world\")\n- Press key: type(key=\"Enter\")\n- Key with modifier: type(key=\"a\", ctrl=true)  # Ctrl+A\n- Clear and type: type(selector=\"#search\", text=\"query\", clear=true)\nRESPONSE EXAMPLE:\n{\n  \"success\": true,\n  \"typed\": \"user@example.com\",\n  \"element\": {\"tag\": \"INPUT\", \"type\": \"email\"}\n}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "text": {
            "type": "string",
            "description": "Text to type"
          },
          "selector": {
            "type": "string",
            "description": "CSS selector of input element (omit to type into focused)"
          },
          "backendDOMNodeId": {
            "type": "integer",
            "description": "Stable element handle (from page(detail='ax'))"
          },
          "ref": {
            "type": "string",
            "description": "Stable element ref like 'dom:123' (from page(detail='ax'))"
          },
          "key": {
            "type": "string",
            "description": "Key to press (Enter, Tab, Escape, ArrowUp, etc.)"
          },
          "clear": {
            "type": "boolean",
            "default": false,
            "description": "Clear existing value before typing"
          },
          "submit": {
            "type": "boolean",
            "default": false,
            "description": "Press Enter after typing"
          },
          "ctrl": {
            "type": "boolean",
            "description": "Hold Ctrl"
          },
          "alt": {
            "type": "boolean",
            "description": "Hold Alt"
          },
          "shift": {
            "type": "boolean",
            "description": "Hold Shift"
          },
          "meta": {
            "type": "boolean",
            "description": "Hold Meta/Cmd"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "scroll",
      "description": "Scroll the page in any direction or to specific element.\nUSAGE:\n- Scroll down: scroll(direction=\"down\")\n- Scroll up 500px: scroll(direction=\"up\", amount=500)\n- Scroll to element: scroll(to=\"#footer\")\n- Scroll to stable handle: scroll(ref=\"dom:123\")\n- Scroll to bottom: scroll(to_bottom=true)\n- Scroll to top: scroll(to_top=true)\n- Scroll inside container: scroll(direction=\"down\", amount=400, container_selector=\".feed\")\nRESPONSE EXAMPLE:\n{\n  \"scrollX\": 0,\n  \"scrollY\": 450,\n  \"atBottom\": false,\n  \"atTop\": false\n}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "direction": {
            "type": "string",
            "enum": [
              "up",
              "down",
              "left",
              "right"
            ],
            "description": "Scroll direction"
          },
          "amount": {
            "type": "number",
            "default": 300,
            "description": "Pixels to scroll (default: 300)"
          },
          "to": {
            "type": "string",
            "description": "CSS selector of element to scroll into view"
          },
          "backendDOMNodeId": {
            "type": "integer",
            "description": "Stable element handle to scroll into view (from page(detail='ax'))"
          },
          "ref": {
            "type": "string",
            "description": "Stable element ref like 'dom:123' (from page(detail='ax'))"
          },
          "to_top": {
            "type": "boolean",
            "description": "Scroll to top of page"
          },
          "to_bottom": {
            "type": "boolean",
            "description": "Scroll to bottom of page"
          },
          "container_selector": {
            "type": "string",
            "description": "Optional CSS selector for a scrollable container (for feeds/lists)"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "form",
      "description": "Work with forms: fill fields, select options, submit.\nUSAGE:\n- Fill form: form(fill={\"email\": \"user@example.com\", \"password\": \"secret\"})\n- Fill and submit: form(fill={...}, submit=true)\n- Select dropdown: form(select={\"selector\": \"#country\", \"value\": \"US\"})\n- Focus element: form(focus=\"#email\")\n- Focus field by label/name (iframe-safe): form(focus_key=\"Email Address\", form_index=0)\n- Clear input: form(clear=\"#search\")\n- Wait for element: form(wait_for=\"#results\", timeout=10)\nRESPONSE EXAMPLE:\n{\n  \"action\": \"fill\",\n  \"fields_filled\": 3,\n  \"submitted\": true\n}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "fill": {
            "type": "object",
            "additionalProperties": true,
            "description": "Field names/labels mapped to values"
          },
          "submit": {
            "type": "boolean",
            "default": false,
            "description": "Submit form after filling"
          },
          "form_index": {
            "type": "integer",
            "default": 0,
            "description": "Which form on page (0=first)"
          },
          "select": {
            "type": "object",
            "properties": {
              "selector": {
                "type": "string"
              },
              "value": {
                "type": "string"
              },
              "by": {
                "type": "string",
                "enum": [
                  "value",
                  "text",
                  "index"
                ]
              }
            },
            "description": "Select dropdown option"
          },
          "focus": {
            "type": "string",
            "description": "CSS selector of element to focus"
          },
          "focus_key": {
            "type": "string",
            "description": "Focus a field by label/name/id/placeholder (works across same-origin iframes + open shadow DOM)"
          },
          "clear": {
            "type": "string",
            "description": "CSS selector of input to clear"
          },
          "wait_for": {
            "type": "string",
            "description": "CSS selector to wait for"
          },
          "timeout": {
            "type": "number",
            "default": 10,
            "description": "Timeout for wait_for in seconds"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "screenshot",
      "description": "Take a screenshot of the current page.\nUSAGE:\n- Full page: screenshot()\n- Specific element: screenshot(selector=\"#main-content\")\n- By stable handle: screenshot(ref=\"dom:123\")  # or backendDOMNodeId=123\n\nRESPONSE: Base64 PNG image",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "selector": {
            "type": "string",
            "description": "CSS selector to screenshot specific element"
          },
          "backendDOMNodeId": {
            "type": "integer",
            "description": "Stable element handle (from page(detail='ax'))"
          },
          "ref": {
            "type": "string",
            "description": "Stable element ref like 'dom:123' (from page(detail='ax'))"
          },
          "full_page": {
            "type": "boolean",
            "default": false,
            "description": "Capture full scrollable page"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "tabs",
      "description": "Manage browser tabs: list, switch, open, close.\nUSAGE:\n- List tabs: tabs(action=\"list\")\n- Switch by ID: tabs(action=\"switch\", tab_id=\"ABC123\")\n- Switch by URL: tabs(action=\"switch\", url_contains=\"github\")\n- Open new tab: tabs(action=\"new\", url=\"https://example.com\")\n- Rescue (fresh tab, no restart): tabs(action=\"rescue\")\n- Close current: tabs(action=\"close\")\n- Close by ID: tabs(action=\"close\", tab_id=\"ABC123\")\n\nRESPONSE EXAMPLE (list):\n{\n  \"action\": \"list\",\n  \"tabs\": [\n    {\"id\": \"ABC123\", \"url\": \"https://example.com\", \"title\": \"Example\", \"active\": true}\n  ],\n  \"total\": 1\n}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "enum": [
              "list",
              "switch",
              "new",
              "close",
              "rescue"
            ],
            "default": "list",
            "description": "Tab action"
          },
          "tab_id": {
            "type": "string",
            "description": "Tab ID for switch/close"
          },
          "url_contains": {
            "type": "string",
            "description": "Switch to tab containing this URL substring"
          },
          "url": {
            "type": "string",
            "description": "URL for new tab"
          },
          "close_old": {
            "type": "boolean",
            "default": true,
            "description": "For rescue: close the previous session tab (best-effort) (default: true)"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "cookies",
      "description": "Manage browser cookies: get, set, delete.\nUSAGE:\n- Get all: cookies(action=\"get\")\n- Get filtered: cookies(action=\"get\", name_filter=\"session\")\n- Set one: cookies(action=\"set\", name=\"token\", value=\"abc\", domain=\".example.com\")\n- Set multiple: cookies(action=\"set\", cookies=[{name, value, domain}, ...])\n- Delete: cookies(action=\"delete\", name=\"token\")\n\nRESPONSE EXAMPLE (get):\n{\n  \"action\": \"get\",\n  \"cookies\": [\n    {\"name\": \"session\", \"value\": \"abc123\", \"domain\": \".example.com\"}\n  ],\n  \"total\": 1\n}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "enum": [
              "get",
              "set",
              "delete"
            ],
            "default": "get",
            "description": "Cookie action"
          },
          "name": {
            "type": "string",
            "description": "Cookie name"
          },
          "value": {
            "type": "string",
            "description": "Cookie value (for set)"
          },
          "domain": {
            "type": "string",
            "description": "Cookie domain (for set)"
          },
          "path": {
            "type": "string",
            "default": "/",
            "description": "Cookie path"
          },
          "secure": {
            "type": "boolean",
            "description": "HTTPS only"
          },
          "httpOnly": {
            "type": "boolean",
            "description": "HTTP only"
          },
          "expires": {
            "type": "number",
            "description": "Expiration timestamp"
          },
          "sameSite": {
            "type": "string",
            "enum": [
              "Strict",
              "Lax",
              "None"
            ]
          },
          "cookies": {
            "type": "array",
            "items": {
              "type": "object"
            },
            "description": "Multiple cookies to set"
          },
          "name_filter": {
            "type": "string",
            "description": "Filter cookies by name substring"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "captcha",
      "description": "Detect and interact with CAPTCHAs.\nUSAGE:\n- Analyze CAPTCHA: captcha(action=\"analyze\")\n- Get screenshot with grid: captcha(action=\"screenshot\")\n- Click checkbox: captcha(action=\"click_checkbox\")\n- Click grid blocks: captcha(action=\"click_blocks\", blocks=[1, 4, 7])\n- Submit: captcha(action=\"submit\")\n\nWORKFLOW:\n1. captcha(action=\"analyze\") - detect type\n2. captcha(action=\"screenshot\") - see the challenge\n3. captcha(action=\"click_blocks\", blocks=[...]) - select images\n4. captcha(action=\"submit\") - verify\n\nRESPONSE EXAMPLE (analyze):\n{\n  \"detected\": true,\n  \"type\": \"recaptcha_v2_image\",\n  \"challenge\": \"Select all images with traffic lights\",\n  \"grid\": {\"rows\": 3, \"cols\": 3}\n}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "enum": [
              "analyze",
              "screenshot",
              "click_checkbox",
              "click_blocks",
              "click_area",
              "submit"
            ],
            "default": "analyze",
            "description": "CAPTCHA action"
          },
          "blocks": {
            "type": "array",
            "items": {
              "type": "integer"
            },
            "description": "Block numbers to click (1-indexed)"
          },
          "area_id": {
            "type": "integer",
            "description": "Clickable area ID from analyze"
          },
          "grid_size": {
            "type": "integer",
            "description": "Force grid size (3 or 4)"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "mouse",
      "description": "Low-level mouse operations: move, hover, drag.\nUSAGE:\n- Move to coordinates: mouse(action=\"move\", x=100, y=200)\n- Hover element: mouse(action=\"hover\", selector=\"#menu\")\n- Hover element by ref: mouse(action=\"hover\", ref=\"dom:123\")\n- Drag and drop: mouse(action=\"drag\", from_x=100, from_y=100, to_x=300, to_y=300)\n- Drag by refs: mouse(action=\"drag\", from_ref=\"dom:123\", to_ref=\"dom:456\")\n- Drag from ref to coords: mouse(action=\"drag\", from_ref=\"dom:123\", to_x=300, to_y=300)\n- Drag from coords to ref: mouse(action=\"drag\", from_x=100, from_y=100, to_ref=\"dom:456\")\nRESPONSE EXAMPLE:\n{\n  \"action\": \"hover\",\n  \"position\": {\"x\": 150, \"y\": 200}\n}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "enum": [
              "move",
              "hover",
              "drag"
            ],
            "description": "Mouse action to perform"
          },
          "x": {
            "type": "number",
            "description": "X coordinate"
          },
          "y": {
            "type": "number",
            "description": "Y coordinate"
          },
          "selector": {
            "type": "string",
            "description": "CSS selector for hover action"
          },
          "backendDOMNodeId": {
            "type": "integer",
            "description": "Stable element handle (for hover; from page(detail='ax'))"
          },
          "ref": {
            "type": "string",
            "description": "Stable element ref like 'dom:123' (for hover; from page(detail='ax'))"
          },
          "from_x": {
            "type": "number",
            "description": "Drag start X"
          },
          "from_y": {
            "type": "number",
            "description": "Drag start Y"
          },
          "to_x": {
            "type": "number",
            "description": "Drag end X"
          },
          "to_y": {
            "type": "number",
            "description": "Drag end Y"
          },
          "from_backendDOMNodeId": {
            "type": "integer",
            "description": "Stable drag start handle (from page(detail='ax'))"
          },
          "to_backendDOMNodeId": {
            "type": "integer",
            "description": "Stable drag end handle (from page(detail='ax'))"
          },
          "from_ref": {
            "type": "string",
            "description": "Stable drag start ref like 'dom:123' (from page(detail='ax'))"
          },
          "to_ref": {
            "type": "string",
            "description": "Stable drag end ref like 'dom:123' (from page(detail='ax'))"
          },
          "steps": {
            "type": "integer",
            "default": 10,
            "description": "Drag interpolation steps"
          }
        },
        "required": [
          "action"
        ],
        "additionalProperties": false
      }
    },
    {
      "name": "resize",
      "description": "Resize browser viewport or window.\nUSAGE:\n- Resize viewport: resize(width=1280, height=720)\n- Resize window: resize(width=1280, height=720, target=\"window\")\n- Mobile viewport: resize(width=375, height=667)\nRESPONSE EXAMPLE:\n{\n  \"target\": \"viewport\",\n  \"width\": 1280,\n  \"height\": 720\n}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "width": {
            "type": "integer",
            "description": "Width in pixels"
          },
          "height": {
            "type": "integer",
            "description": "Height in pixels"
          },
          "target": {
            "type": "string",
            "enum": [
              "viewport",
              "window"
            ],
            "default": "viewport",
            "description": "What to resize"
          }
        },
        "required": [
          "width",
          "height"
        ],
        "additionalProperties": false
      }
    },
    {
      "name": "js",
      "description": "Execute JavaScript in browser context.\nUSAGE: js(code=\"document.title\")\nRESPONSE EXAMPLE:\n{\"result\": \"Page Title\"}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "default": {},
        "properties": {
          "code": {
            "type": "string",
            "description": "JavaScript code to execute"
          }
        },
        "required": [
          "code"
        ],
        "additionalProperties": false
      }
    },
    {
      "name": "http",
      "description": "Make HTTP request (not through browser).\nUSAGE: http(url=\"https://api.example.com/data\")\n\nUse for API calls. For page fetching, use navigate() instead.",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "description": "URL to fetch"
          }
        },
        "required": [
          "url"
        ],
        "additionalProperties": false
      }
    },
    {
      "name": "fetch",
      "description": "Make fetch request from browser context (with cookies/session).\nUSAGE: fetch(url=\"/api/user\", method=\"POST\", body='{\"name\": \"test\"}')\n\nUseful for authenticated API calls.",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "url": {
            "type": "string",
            "description": "URL to fetch"
          },
          "method": {
            "type": "string",
            "enum": [
              "GET",
              "POST",
              "PUT",
              "DELETE",
              "PATCH"
            ],
            "default": "GET"
          },
          "body": {
            "type": "string",
            "description": "Request body"
          },
          "headers": {
            "type": "object",
            "description": "Request headers"
          },
          "fallback_http": {
            "type": "boolean",
            "default": false,
            "description": "Fallback to http() on CORS/opaque errors (GET only; allowlist enforced)."
          }
        },
        "required": [
          "url"
        ],
        "additionalProperties": false
      }
    },
    {
      "name": "storage",
      "description": "Storage operations (localStorage / sessionStorage).\nUSAGE:\n- List keys: storage(action=\"list\", storage=\"local\", limit=20)\n- Get value (preview): storage(action=\"get\", key=\"theme\", reveal=true)\n- Set one: storage(action=\"set\", key=\"theme\", value=\"dark\")\n- Set many: storage(action=\"set_many\", items={\"k1\":\"v1\",\"k2\":\"v2\"})\n- Delete: storage(action=\"delete\", key=\"theme\")\n- Clear: storage(action=\"clear\")\n\nNOTES:\n- Safe-by-default: strict policy blocks mutation and sensitive value reveal.\n- To store a revealed value off-context: storage(action=\"get\", key=\"...\", reveal=true, store=true)",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "enum": [
              "list",
              "get",
              "set",
              "set_many",
              "delete",
              "clear"
            ],
            "default": "list"
          },
          "storage": {
            "type": "string",
            "enum": [
              "local",
              "session"
            ],
            "default": "local",
            "description": "Storage backend"
          },
          "key": {
            "type": "string",
            "description": "Storage key (get/set/delete)"
          },
          "value": {
            "description": "Value to set (set)",
            "type": [
              "string",
              "number",
              "boolean",
              "object",
              "array",
              "null"
            ],
            "items": {},
            "additionalProperties": true
          },
          "items": {
            "type": "object",
            "description": "Key/value map for set_many",
            "additionalProperties": true
          },
          "offset": {
            "type": "integer",
            "default": 0
          },
          "limit": {
            "type": "integer",
            "default": 20
          },
          "max_chars": {
            "type": "integer",
            "default": 2000
          },
          "reveal": {
            "type": "boolean",
            "default": false,
            "description": "Reveal value preview (unsafe; strict may block sensitive keys)"
          },
          "store": {
            "type": "boolean",
            "default": false,
            "description": "Store revealed value off-context as an artifact (requires reveal=true)"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "upload",
      "description": "Upload file to file input.\nUSAGE: upload(file_paths=[\"/path/to/file.pdf\"])",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "file_paths": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Absolute paths to files"
          },
          "selector": {
            "type": "string",
            "description": "File input selector (auto-detected if omitted)"
          }
        },
        "required": [
          "file_paths"
        ],
        "additionalProperties": false
      }
    },
    {
      "name": "download",
      "description": "Wait for a download to complete and optionally store it as an artifact.\nUSAGE:\n- Store as artifact (default): download(timeout=30)\n- Metadata only: download(store=false)\n\nNOTES:\n- Designed to be used after triggering a download (click).\n- Keeps output cognitive-cheap: returns an artifact id + minimal metadata.",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "timeout": {
            "type": "number",
            "default": 30.0,
            "description": "Seconds to wait for a new download (default: 30.0)"
          },
          "poll_interval": {
            "type": "number",
            "default": 0.2,
            "description": "Polling interval seconds (default: 0.2)"
          },
          "stable_ms": {
            "type": "integer",
            "default": 500,
            "description": "File size must be stable for N ms before considering it complete (default: 500)"
          },
          "store": {
            "type": "boolean",
            "default": true,
            "description": "Store the downloaded file as an artifact (default: true)"
          },
          "sha256": {
            "type": "boolean",
            "default": true,
            "description": "Compute sha256 for small downloads (default: true; may skip for large files)"
          },
          "sha256_max_bytes": {
            "type": "integer",
            "default": 209715200,
            "description": "Max bytes to hash for sha256 (default: 200MB). Larger files skip hashing."
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "dialog",
      "description": "Handle JavaScript alert/confirm/prompt dialogs.\nUSAGE:\n- Accept: dialog(accept=true)\n- Dismiss: dialog(accept=false)\n- With text: dialog(accept=true, text=\"my answer\")",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "accept": {
            "type": "boolean",
            "default": true,
            "description": "Accept or dismiss"
          },
          "text": {
            "type": "string",
            "description": "Text for prompt dialog"
          },
          "timeout": {
            "type": "number",
            "default": 2,
            "description": "Max seconds to wait for a dialog to appear when none is active"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "totp",
      "description": "Generate TOTP code for 2FA.\nUSAGE: totp(secret=\"JBSWY3DPEHPK3PXP\")\n\nRESPONSE: {\"code\": \"123456\", \"remaining_seconds\": 15}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "secret": {
            "type": "string",
            "description": "Base32-encoded TOTP secret"
          },
          "digits": {
            "type": "integer",
            "default": 6
          },
          "interval": {
            "type": "integer",
            "default": 30
          }
        },
        "required": [
          "secret"
        ],
        "additionalProperties": false
      }
    },
    {
      "name": "wait",
      "description": "Wait for condition.\nUSAGE:\n- Wait for element: wait(for=\"element\", selector=\"#results\")\n- Wait for text: wait(for=\"text\", text=\"Success\")\n- Wait for DOMContentLoaded: wait(for=\"domcontentloaded\")\n- Wait for navigation: wait(for=\"navigation\")\n- Wait for network idle: wait(for=\"networkidle\")\n\nRESPONSE: {\"waited_for\": \"element\", \"found\": true, \"duration_ms\": 1500}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "for": {
            "type": "string",
            "enum": [
              "element",
              "text",
              "navigation",
              "domcontentloaded",
              "networkidle",
              "load"
            ],
            "description": "What to wait for"
          },
          "selector": {
            "type": "string",
            "description": "For element wait"
          },
          "text": {
            "type": "string",
            "description": "For text wait"
          },
          "timeout": {
            "type": "number",
            "default": 10,
            "description": "Timeout in seconds"
          }
        },
        "required": [
          "for"
        ],
        "additionalProperties": false
      }
    },
    {
      "name": "browser",
      "description": "Browser control: lifecycle + policy + DOM.\nUSAGE:\n- Check status: browser(action=\"status\")\n- Launch: browser(action=\"launch\")\n- Emergency recovery (CDP hung / dialog-brick): browser(action=\"recover\")  # add hard=true to restart owned Chrome\n- Get/set safety policy: browser(action=\"policy\", mode=\"strict\")  # or mode=\"permissive\"\n- Get DOM: browser(action=\"dom\", selector=\"#content\")\n- Store DOM as artifact (no huge dump): browser(action=\"dom\", store=true)\n- Get element: browser(action=\"element\", selector=\"#btn\")\n- Agent memory (safe KV): browser(action=\"memory\", memory_action=\"set\", key=\"token\", value=\"...\")\n- Agent memory list: browser(action=\"memory\", memory_action=\"list\")\n- Agent memory get (redacted by default): browser(action=\"memory\", memory_action=\"get\", key=\"token\")\n- Persist memory (non-sensitive): browser(action=\"memory\", memory_action=\"save\")\n- Load memory (after restart): browser(action=\"memory\", memory_action=\"load\")\n- Use memory in run without revealing: run(actions=[{type:{selector:\"#pwd\", text:\"{{mem:token}}\"}}], report=\"map\")\n\nDRILLDOWN:\n- browser(action=\"artifact\", artifact_action=\"get\", id=\"...\", offset=0, max_chars=4000)\n\nRESPONSE (status):\n{\"running\": true, \"version\": \"Chrome/130.0\", \"port\": 9222}",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "enum": [
              "status",
              "launch",
              "recover",
              "policy",
              "dom",
              "element",
              "artifact",
              "memory"
            ],
            "default": "status"
          },
          "hard": {
            "type": "boolean",
            "default": false,
            "description": "Hard recovery (restart owned Chrome). If false, may still escalate to hard when CDP is unresponsive (action='recover')"
          },
          "timeout": {
            "type": "number",
            "default": 5.0,
            "description": "Recovery timeout in seconds (action='recover')"
          },
          "mode": {
            "type": "string",
            "enum": [
              "permissive",
              "strict"
            ],
            "description": "Safety policy mode (for action='policy')"
          },
          "selector": {
            "type": "string",
            "description": "For dom/element actions"
          },
          "store": {
            "type": "boolean",
            "default": false,
            "description": "Store full DOM off-context as an artifact (use with action='dom')"
          },
          "max_chars": {
            "type": "integer",
            "default": 50000,
            "description": "Max DOM chars (action='dom') or max artifact slice chars (action='artifact', hard-capped to 4000)"
          },
          "artifact_action": {
            "type": "string",
            "enum": [
              "list",
              "get",
              "delete",
              "export"
            ],
            "default": "list",
            "description": "Artifact action (for action='artifact')"
          },
          "id": {
            "type": "string",
            "description": "Artifact id (required for artifact_action='get'|'delete')"
          },
          "kind": {
            "type": "string",
            "description": "Filter by kind (artifact_action='list')"
          },
          "limit": {
            "type": "integer",
            "default": 20,
            "description": "Max items for artifact_action='list'"
          },
          "offset": {
            "type": "integer",
            "default": 0,
            "description": "Text offset for artifact_action='get' (chars)"
          },
          "name": {
            "type": "string",
            "description": "Export filename (optional, artifact_action='export')"
          },
          "overwrite": {
            "type": "boolean",
            "default": false,
            "description": "Overwrite export destination if exists (artifact_action='export')"
          },
          "memory_action": {
            "type": "string",
            "enum": [
              "list",
              "get",
              "set",
              "delete",
              "clear",
              "save",
              "load"
            ],
            "default": "list",
            "description": "Memory operation (requires action='memory')"
          },
          "key": {
            "type": "string",
            "description": "Memory key (get/set/delete)"
          },
          "prefix": {
            "type": "string",
            "description": "Key prefix filter (list/clear)"
          },
          "value": {
            "description": "Memory value (set)",
            "type": [
              "string",
              "number",
              "boolean",
              "object",
              "array",
              "null"
            ],
            "items": {},
            "additionalProperties": true
          },
          "reveal": {
            "type": "boolean",
            "default": false,
            "description": "Reveal value on get (unsafe; blocked by strict policy for sensitive keys)"
          },
          "memory_max_chars": {
            "type": "integer",
            "default": 2000,
            "description": "Max chars to return when reveal=true (memory get)"
          },
          "memory_max_bytes": {
            "type": "integer",
            "default": 20000,
            "description": "Max stored bytes for set (memory set)"
          },
          "memory_max_keys": {
            "type": "integer",
            "default": 200,
            "description": "Max keys for memory store (LRU-evicted)"
          },
          "persist": {
            "type": "boolean",
            "default": false,
            "description": "If true, also write memory snapshot to disk (permissive only)"
          },
          "allow_sensitive": {
            "type": "boolean",
            "default": false,
            "description": "Allow persisting/loading sensitive keys (NOT encrypted; use carefully)"
          },
          "replace": {
            "type": "boolean",
            "default": false,
            "description": "If true, load replaces current memory (load only)"
          }
        },
        "additionalProperties": false
      }
    },
    {
      "name": "artifact",
      "description": "Artifact store for high-fidelity payloads (keeps context window small).\nUSAGE:\n- List: artifact(action=\"list\", limit=20)\n- Get text slice: artifact(action=\"get\", id=\"...\", offset=0, max_chars=4000)\n- Delete: artifact(action=\"delete\", id=\"...\")\n- Export to outbox: artifact(action=\"export\", id=\"...\", name=\"optional.ext\", overwrite=false)\n\nNOTE:\n- Large payloads are produced by other tools (e.g., browser(action=\"dom\", store=true)).",
      "inputSchema": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "enum": [
              "list",
              "get",
              "delete",
              "export"
            ],
            "default": "list",
            "description": "Artifact action"
          },
          "id": {
            "type": "string",
            "description": "Artifact id (required for get/delete/export)"
          },
          "kind": {
            "type": "string",
            "description": "Filter by kind (list only)"
          },
          "limit": {
            "type": "integer",
            "default": 20,
            "description": "Max items for list"
          },
          "offset": {
            "type": "integer",
            "default": 0,
            "description": "Text offset for get (chars)"
          },
          "max_chars": {
            "type": "integer",
            "default": 4000,
            "description": "Max returned chars for get"
          },
          "name": {
            "type": "string",
            "description": "Export filename (optional, export only)"
          },
          "overwrite": {
            "type": "boolean",
            "default": false,
            "description": "Overwrite export destination if exists (export only)"
          }
        },
        "additionalProperties": false
      }
    }
  ]
}
