#!/usr/bin/env python3
from __future__ import annotations

import sys
from pathlib import Path


def _repo_root() -> Path:
    return Path(__file__).resolve().parents[1]


def main() -> int:
    root = _repo_root()
    sys.path.insert(0, str(root))
    from mcp_servers.browser.native_host_installer import install_native_host

    print("== install_native_host ==")
    print(f"repo: {root}")

    report = install_native_host(root=root)
    if not report.ok:
        for err in report.errors:
            print(f"ERROR: {err}", file=sys.stderr)
        return 2

    for entry in report.wrote:
        print(f"OK: installed for {entry}")

    print("\nNext:")
    print("- If the extension is enabled, it will auto-reconnect within ~1 minute.")
    print("- If it stays disconnected, reload it once in chrome://extensions.")
    print("- Popup → Advanced → Transport shows `native` when connected.")
    return 0


if __name__ == "__main__":
    raise SystemExit(main())
